/*!
 * MIT License
 *
 * Copyright (c) 2018 Photopea
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
var UZIP={};"object"==typeof module&&(module.exports=UZIP),UZIP.parse=function(buf,onlyNames){for(var rUs=UZIP.bin.readUshort,rUi=UZIP.bin.readUint,o=0,out={},data=new Uint8Array(buf),eocd=data.length-4;101010256!=rUi(data,eocd);)eocd--;o=eocd;o+=4;var cnu=rUs(data,o+=4),csize=(rUs(data,o+=2),rUi(data,o+=2)),coffs=rUi(data,o+=4);o+=4,o=coffs;for(var i=0;i<cnu;i++){rUi(data,o);o+=4,o+=4,o+=4;rUi(data,o+=4),csize=rUi(data,o+=4);var usize=rUi(data,o+=4),nl=rUs(data,o+=4),el=rUs(data,o+2),cl=rUs(data,o+4);o+=6;var roff=rUi(data,o+=8);o+=4,o+=nl+el+cl,UZIP._readLocal(data,roff,out,csize,usize,onlyNames)}return out},UZIP._readLocal=function(data,o,out,csize,usize,onlyNames){var rUs=UZIP.bin.readUshort,rUi=UZIP.bin.readUint,cmpr=(rUi(data,o),rUs(data,o+=4),rUs(data,o+=2),rUs(data,o+=2));rUi(data,o+=2),rUi(data,o+=4);o+=4;var nlen=rUs(data,o+=8),elen=rUs(data,o+=2);o+=2;var name=UZIP.bin.readUTF8(data,o,nlen);if(o+=nlen,o+=elen,onlyNames)out[name]={size:usize,csize:csize};else{var file=new Uint8Array(data.buffer,o);if(0==cmpr)out[name]=new Uint8Array(file.buffer.slice(o,o+csize));else{if(8!=cmpr)throw"unknown compression method: "+cmpr;var buf=new Uint8Array(usize);UZIP.inflateRaw(file,buf),out[name]=buf}}},UZIP.inflateRaw=function(file,buf){return UZIP.F.inflate(file,buf)},UZIP.inflate=function(file,buf){file[0],file[1];return UZIP.inflateRaw(new Uint8Array(file.buffer,file.byteOffset+2,file.length-6),buf)},UZIP.crc={table:function(){for(var tab=new Uint32Array(256),n=0;n<256;n++){for(var c=n,k=0;k<8;k++)1&c?c=3988292384^c>>>1:c>>>=1;tab[n]=c}return tab}(),update:function(c,buf,off,len){for(var i=0;i<len;i++)c=UZIP.crc.table[255&(c^buf[off+i])]^c>>>8;return c},crc:function(b,o,l){return 4294967295^UZIP.crc.update(4294967295,b,o,l)}},UZIP.bin={readUshort:function(buff,p){return buff[p]|buff[p+1]<<8},readUint:function(buff,p){return 16777216*buff[p+3]+(buff[p+2]<<16|buff[p+1]<<8|buff[p])},readASCII:function(buff,p,l){for(var s="",i=0;i<l;i++)s+=String.fromCharCode(buff[p+i]);return s},pad:function(n){return n.length<2?"0"+n:n},readUTF8:function(buff,p,l){for(var ns,s="",i=0;i<l;i++)s+="%"+UZIP.bin.pad(buff[p+i].toString(16));try{ns=decodeURIComponent(s)}catch(e){return UZIP.bin.readASCII(buff,p,l)}return ns}},UZIP.F={},UZIP.F.inflate=function(data,buf){var u8=Uint8Array;if(3==data[0]&&0==data[1])return buf||new u8(0);var F=UZIP.F,bitsF=F._bitsF,bitsE=F._bitsE,decodeTiny=F._decodeTiny,makeCodes=F.makeCodes,codes2map=F.codes2map,get17=F._get17,U=F.U,noBuf=null==buf;noBuf&&(buf=new u8(data.length>>>2<<3));for(var lmap,dmap,BFINAL=0,BTYPE=0,HLIT=0,HDIST=0,HCLEN=0,ML=0,MD=0,off=0,pos=0;0==BFINAL;)if(BFINAL=bitsF(data,pos,1),BTYPE=bitsF(data,pos+1,2),pos+=3,0!=BTYPE){if(noBuf&&(buf=UZIP.F._check(buf,off+(1<<17))),1==BTYPE&&(lmap=U.flmap,dmap=U.fdmap,ML=511,MD=31),2==BTYPE){HLIT=bitsE(data,pos,5)+257,HDIST=bitsE(data,pos+5,5)+1,HCLEN=bitsE(data,pos+10,4)+4;pos+=14;for(var i=0;i<38;i+=2)U.itree[i]=0,U.itree[i+1]=0;var tl=1;for(i=0;i<HCLEN;i++){var l=bitsE(data,pos+3*i,3);U.itree[1+(U.ordr[i]<<1)]=l,l>tl&&(tl=l)}pos+=3*HCLEN,makeCodes(U.itree,tl),codes2map(U.itree,tl,U.imap),lmap=U.lmap,dmap=U.dmap,pos=decodeTiny(U.imap,(1<<tl)-1,HLIT+HDIST,data,pos,U.ttree);var mx0=F._copyOut(U.ttree,0,HLIT,U.ltree);ML=(1<<mx0)-1;var mx1=F._copyOut(U.ttree,HLIT,HDIST,U.dtree);MD=(1<<mx1)-1,makeCodes(U.ltree,mx0),codes2map(U.ltree,mx0,lmap),makeCodes(U.dtree,mx1),codes2map(U.dtree,mx1,dmap)}for(;;){var code=lmap[get17(data,pos)&ML];pos+=15&code;var lit=code>>>4;if(lit>>>8==0)buf[off++]=lit;else{if(256==lit)break;var end=off+lit-254;if(lit>264){var ebs=U.ldef[lit-257];end=off+(ebs>>>3)+bitsE(data,pos,7&ebs),pos+=7&ebs}var dcode=dmap[get17(data,pos)&MD];pos+=15&dcode;var dlit=dcode>>>4,dbs=U.ddef[dlit],dst=(dbs>>>4)+bitsF(data,pos,15&dbs);for(pos+=15&dbs,noBuf&&(buf=UZIP.F._check(buf,off+(1<<17)));off<end;)buf[off]=buf[off++-dst],buf[off]=buf[off++-dst],buf[off]=buf[off++-dst],buf[off]=buf[off++-dst];off=end}}}else{0!=(7&pos)&&(pos+=8-(7&pos));var p8=4+(pos>>>3),len=data[p8-4]|data[p8-3]<<8;noBuf&&(buf=UZIP.F._check(buf,off+len)),buf.set(new u8(data.buffer,data.byteOffset+p8,len),off),pos=p8+len<<3,off+=len}return buf.length==off?buf:buf.slice(0,off)},UZIP.F._check=function(buf,len){var bl=buf.length;if(len<=bl)return buf;var nbuf=new Uint8Array(Math.max(bl<<1,len));return nbuf.set(buf,0),nbuf},UZIP.F._decodeTiny=function(lmap,LL,len,data,pos,tree){for(var bitsE=UZIP.F._bitsE,get17=UZIP.F._get17,i=0;i<len;){var code=lmap[get17(data,pos)&LL];pos+=15&code;var lit=code>>>4;if(lit<=15)tree[i]=lit,i++;else{var ll=0,n=0;16==lit?(n=3+bitsE(data,pos,2),pos+=2,ll=tree[i-1]):17==lit?(n=3+bitsE(data,pos,3),pos+=3):18==lit&&(n=11+bitsE(data,pos,7),pos+=7);for(var ni=i+n;i<ni;)tree[i]=ll,i++}}return pos},UZIP.F._copyOut=function(src,off,len,tree){for(var mx=0,i=0,tl=tree.length>>>1;i<len;){var v=src[i+off];tree[i<<1]=0,tree[1+(i<<1)]=v,v>mx&&(mx=v),i++}for(;i<tl;)tree[i<<1]=0,tree[1+(i<<1)]=0,i++;return mx},UZIP.F.makeCodes=function(tree,MAX_BITS){for(var code,bits,n,len,U=UZIP.F.U,max_code=tree.length,bl_count=U.bl_count,i=0;i<=MAX_BITS;i++)bl_count[i]=0;for(i=1;i<max_code;i+=2)bl_count[tree[i]]++;var next_code=U.next_code;for(code=0,bl_count[0]=0,bits=1;bits<=MAX_BITS;bits++)code=code+bl_count[bits-1]<<1,next_code[bits]=code;for(n=0;n<max_code;n+=2)0!=(len=tree[n+1])&&(tree[n]=next_code[len],next_code[len]++)},UZIP.F.codes2map=function(tree,MAX_BITS,map){for(var max_code=tree.length,r15=UZIP.F.U.rev15,i=0;i<max_code;i+=2)if(0!=tree[i+1])for(var lit=i>>1,cl=tree[i+1],val=lit<<4|cl,rest=MAX_BITS-cl,i0=tree[i]<<rest,i1=i0+(1<<rest);i0!=i1;){map[r15[i0]>>>15-MAX_BITS]=val,i0++}},UZIP.F.revCodes=function(tree,MAX_BITS){for(var r15=UZIP.F.U.rev15,imb=15-MAX_BITS,i=0;i<tree.length;i+=2){var i0=tree[i]<<MAX_BITS-tree[i+1];tree[i]=r15[i0]>>>imb}},UZIP.F._bitsE=function(dt,pos,length){return(dt[pos>>>3]|dt[1+(pos>>>3)]<<8)>>>(7&pos)&(1<<length)-1},UZIP.F._bitsF=function(dt,pos,length){return(dt[pos>>>3]|dt[1+(pos>>>3)]<<8|dt[2+(pos>>>3)]<<16)>>>(7&pos)&(1<<length)-1},UZIP.F._get17=function(dt,pos){return(dt[pos>>>3]|dt[1+(pos>>>3)]<<8|dt[2+(pos>>>3)]<<16)>>>(7&pos)},UZIP.F._get25=function(dt,pos){return(dt[pos>>>3]|dt[1+(pos>>>3)]<<8|dt[2+(pos>>>3)]<<16|dt[3+(pos>>>3)]<<24)>>>(7&pos)},UZIP.F.U=function(){var u16=Uint16Array,u32=Uint32Array;return{next_code:new u16(16),bl_count:new u16(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new u16(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new u32(32),flmap:new u16(512),fltree:[],fdmap:new u16(32),fdtree:[],lmap:new u16(32768),ltree:[],ttree:[],dmap:new u16(32768),dtree:[],imap:new u16(512),itree:[],rev15:new u16(32768),lhst:new u32(286),dhst:new u32(30),ihst:new u32(19),lits:new u32(15e3),strt:new u16(65536),prev:new u16(32768)}}(),function(){for(var U=UZIP.F.U,i=0;i<32768;i++){var x=i;x=(4278255360&(x=(4042322160&(x=(3435973836&(x=(2863311530&x)>>>1|(1431655765&x)<<1))>>>2|(858993459&x)<<2))>>>4|(252645135&x)<<4))>>>8|(16711935&x)<<8,U.rev15[i]=(x>>>16|x<<16)>>>17}function pushV(tgt,n,sv){for(;0!=n--;)tgt.push(0,sv)}for(i=0;i<32;i++)U.ldef[i]=U.of0[i]<<3|U.exb[i],U.ddef[i]=U.df0[i]<<4|U.dxb[i];pushV(U.fltree,144,8),pushV(U.fltree,112,9),pushV(U.fltree,24,7),pushV(U.fltree,8,8),UZIP.F.makeCodes(U.fltree,9),UZIP.F.codes2map(U.fltree,9,U.flmap),UZIP.F.revCodes(U.fltree,9),pushV(U.fdtree,32,5),UZIP.F.makeCodes(U.fdtree,5),UZIP.F.codes2map(U.fdtree,5,U.fdmap),UZIP.F.revCodes(U.fdtree,5),pushV(U.itree,19,0),pushV(U.ltree,286,0),pushV(U.dtree,30,0),pushV(U.ttree,320,0)}();
